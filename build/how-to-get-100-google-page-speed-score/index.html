<!doctype html> <html> <head> <meta charset=utf-8> <meta http-equiv=x-ua-compatible content="ie=edge"> <meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta name=author content="Michael Elliott"/> <meta name=description content="elliotec | Mike Elliott, a software developer building projects and writing posts."/> <meta name=google-site-verification content=MFyo9_KaHWW1rrf6ct225HChB1FOm1Cf9o6Y60qyYtU /> <title>elliotec | Mike Elliott - How to Get 100/100 Google Page Speed Score with Middleman and Nginx</title> <style>/*! sanitize.css v3.3.0 | CC0 1.0 Public Domain | github.com/10up/sanitize.css */button,input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button}button,hr{overflow:visible}h1,h2{margin:20px 0 16px}pre,textarea{overflow:auto}a,a:focus,a:hover{color:#2196f3}a:focus,a:hover,abbr[title],u{text-decoration:underline}img,select[multiple]{height:auto}hr,legend{width:100%}details,hr,legend,main,pre,summary,textarea{display:block}footer,img,textarea{max-width:100%}*,code{margin:0;padding:0}dl,hr,table{margin-bottom:16px}caption,fieldset,legend{padding:8px 0}legend,ol,textarea,tr,ul{margin-bottom:8px}pre,td,th{padding:16px}::after,::before,td,th{vertical-align:inherit}tfoot tr,thead th{text-align:left}abbr[title]{text-decoration:underline dotted}audio:not([controls]){display:none}b,strong{font-weight:bolder}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}button:-moz-focusring,input:-moz-focusring{outline:ButtonText dotted 1px}button,select{text-transform:none}html{-ms-overflow-style:-ms-autohiding-scrollbar;overflow-y:scroll;-webkit-text-size-adjust:100%}input{-webkit-border-radius:0}input[type=number]{width:auto}input[type=search]{-webkit-appearance:textfield}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}progress{display:inline-block}svg:not(:root){overflow:hidden}[hidden],template{display:none}*,::after,::before{box-sizing:inherit;border-style:solid;border-width:0}footer,hr{border-top:1px solid rgba(0,0,0,0.12)}*{font-size:inherit;line-height:inherit;background-repeat:no-repeat}::after,::before{text-decoration:inherit}button,input,select,textarea{font-family:inherit;font-style:inherit;font-weight:inherit;background-color:transparent;color:inherit}[tabindex],a,area,button,input,label,select,textarea{-ms-touch-action:manipulation;touch-action:manipulation}select::-ms-expand{display:none}select::-ms-value{color:currentColor}svg{fill:currentColor}[aria-busy=true]{cursor:progress}[aria-controls]{cursor:pointer}[aria-disabled]{cursor:default}[hidden][aria-hidden=false]{clip:rect(0 0 0 0);display:inherit;position:absolute}[hidden][aria-hidden=false]:focus{clip:auto}:root{background-color:#fff;box-sizing:border-box;color:#000;cursor:default;font:66.66667% sans-serif}h1,h2,h3{font-weight:500}a{text-decoration:none}audio,canvas,iframe,img,svg,video{vertical-align:middle}code,img,ol,ul{vertical-align:baseline}[type=button],[type=email],[type=month],[type=password],[type=tel],[type=text],[type=time],[type=url],[type=week],[type=reset],[type=submit],[type=number],[type=search],[type=date],[type=datetime],[type=datetime-local],button,select,textarea{min-height:1.5em}code,kbd,pre,samp{font-family:monospace,monospace}nav ol,nav ul{list-style:none}small{font-size:75%;color:rgba(0,0,0,0.54);vertical-align:bottom}::-moz-selection{background-color:#b3d4fc;color:#fff;text-shadow:none}::selection{background-color:#b3d4fc;color:#fff;text-shadow:none}article,aside,details,footer,header,main,section,summary{margin:0 auto 16px;width:100%}main{margin:0 auto;max-width:768px;padding:0 16px 16px}footer{clear:both;display:inline-block;float:left;padding:16px 0;text-align:center}footer p{margin-bottom:0}@media screen and (max-width: 400px){article,aside,section{clear:both;display:block;max-width:100%}}body{color:rgba(0,0,0,0.8);font-family:"Helvetica Neue",Helvetica,"Lucida Grande",sans-serif;font-size:16px;line-height:1.4}p{margin:0 0 16px}h1,h2,h3,h4,h5,h6{color:inherit;font-family:inherit;line-height:inherit}h1{border-bottom:1px solid rgba(0,0,0,0.12);font-size:36px}h2{font-size:30px}h3{font-size:24px;margin:16px 0 4px}h4,h5,h6{font-weight:600;margin:16px 0 4px}h4{font-size:18px}h5{font-size:16px}h6{color:rgba(0,0,0,0.54);font-size:14px}code,pre{font-family:Menlo,Monaco,Consolas,"Courier New",monospace;font-size:16px;color:rgba(0,0,0,0.8)}pre{background:#efefef;margin:16px 0;white-space:pre-wrap}code{line-height:inherit;word-break:break-all;word-wrap:break-word}blockquote,figcaption{font-family:Georgia,Times,"Times New Roman",serif}sub,sup{font-size:14px}dd{margin-left:40px}ol,ul{padding-left:40px}blockquote{border-left:2px solid #2196f3;font-style:italic;margin:16px 0;padding-left:16px}s{text-decoration:line-through}sup{vertical-align:super}sub{vertical-align:sub}mark{background:#ffeb3b}input[type=email],input[type=month],input[type=password],input[type=tel],input[type=text],input[type=time],input[type=url],input[type=week],input[type=number],input[type=search],input[type=date],input[type=datetime],input[type=datetime-local],select{background:#fff;border:1px solid rgba(0,0,0,0.12);border-radius:4px;color:rgba(0,0,0,0.8);display:inline-block;padding:4px;vertical-align:middle}input[type=color]{background:#fff;border:1px solid rgba(0,0,0,0.12);border-radius:4px;display:inline-block;vertical-align:middle}input:not([type]){-webkit-appearance:none;background-clip:padding-box;border:1px solid rgba(0,0,0,0.12);border-radius:4px;display:inline-block;padding:8px;text-align:left}select,textarea{border:1px solid rgba(0,0,0,0.12)}input[type=email]:focus,input[type=month]:focus,input[type=password]:focus,input[type=tel]:focus,input[type=text]:focus,input[type=time]:focus,input[type=url]:focus,input[type=week]:focus,input[type=color]:focus,input[type=number]:focus,input[type=search]:focus,input[type=date]:focus,input[type=datetime]:focus,input[type=datetime-local]:focus,select:focus,textarea:focus{border-color:#2196f3}input:not([type]):focus{border-color:#2196f3}input[type=file]:focus,input[type=radio]:focus,input[type=checkbox]:focus{outline:thin 1px}input[type=email][disabled],input[type=month][disabled],input[type=password][disabled],input[type=tel][disabled],input[type=text][disabled],input[type=time][disabled],input[type=url][disabled],input[type=week][disabled],input[type=color][disabled],input[type=number][disabled],input[type=search][disabled],input[type=date][disabled],input[type=datetime][disabled],input[type=datetime-local][disabled],select[disabled],textarea[disabled]{background-color:rgba(0,0,0,0.12);color:rgba(0,0,0,0.54);cursor:not-allowed}input:not([type])[disabled]{background-color:rgba(0,0,0,0.12);color:rgba(0,0,0,0.54);cursor:not-allowed}input[readonly],select[readonly],textarea[readonly]{border-color:rgba(0,0,0,0.12);color:rgba(0,0,0,0.54)}input:focus:invalid,select:focus:invalid,textarea:focus:invalid{border-color:#ea1c0d;color:#f44336}input[type=file]:focus:invalid:focus,input[type=radio]:focus:invalid:focus,input[type=checkbox]:focus:invalid:focus{outline-color:#f44336}select{-moz-appearance:none;-webkit-appearance:menulist-button;vertical-align:sub}label{line-height:2}fieldset{border:0;margin:0}legend{border-bottom:1px solid rgba(0,0,0,0.12);color:rgba(0,0,0,0.8)}textarea{resize:vertical;background:#fff;border-radius:4px;padding:8px;vertical-align:middle}button,input[type=reset],input[type=submit]{background:#2196f3;border:1px solid rgba(0,0,0,0.12);border-radius:4px;color:#fff;cursor:pointer;display:inline-block;margin:0;padding:8px 16px;text-align:center;vertical-align:middle;white-space:nowrap}button::-moz-focus-inner,input[type=reset]::-moz-focus-inner,input[type=submit]::-moz-focus-inner{padding:0}button:hover,input[type=reset]:hover,input[type=submit]:hover{background:#0c7cd5;border-color:1px solid rgba(0,0,0,0.54)}button:active,input[type=reset]:active,input[type=submit]:active{background:#0c7cd5;border-color:1px solid rgba(0,0,0,0.54);box-shadow:inset 0 0 4px 0 rgba(0,0,0,0.2);outline-offset:-2px}button:focus,input[type=reset]:focus,input[type=submit]:focus{background:#0c7cd5;border-color:1px solid rgba(0,0,0,0.54);box-shadow:inset 0 0 4px 0 rgba(0,0,0,0.2);outline:0}button:disabled,input[type=submit]:disabled{background:rgba(0,0,0,0.12);color:rgba(0,0,0,0.38);cursor:not-allowed}table{border-collapse:collapse;border-spacing:0;border-top:1px solid rgba(0,0,0,0.12)}thead th{border:0;border-bottom:2px solid rgba(0,0,0,0.12)}td,th{border-bottom:1px solid rgba(0,0,0,0.12)}tfoot td{color:rgba(0,0,0,0.54);font-size:8px;font-style:italic;padding:16px 4px}
</style> <style>.highlight table td{padding:5px}.highlight table pre{margin:0}.highlight .c,.highlight .cd{color:#75715e;font-style:italic}.highlight .cm{color:#75715e;font-style:italic}.highlight .c1{color:#75715e;font-style:italic}.highlight .cp{color:#75715e;font-weight:bold}.highlight .cs{color:#75715e;font-weight:bold;font-style:italic}.highlight .err{color:#960050;background-color:#1e0010}.highlight .gi{color:#ffffff;background-color:#324932}.highlight .gd{color:#ffffff;background-color:#493131}.highlight .ge{color:#000000;font-style:italic}.highlight .gr{color:#aa0000}.highlight .gt{color:#aa0000}.highlight .gh{color:#999999}.highlight .go{color:#888888}.highlight .gp{color:#555555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaaaaa}.highlight .k,.highlight .kv{color:#66d9ef;font-weight:bold}.highlight .kc{color:#66d9ef;font-weight:bold}.highlight .kd{color:#66d9ef;font-weight:bold}.highlight .kp{color:#66d9ef;font-weight:bold}.highlight .kr{color:#66d9ef;font-weight:bold}.highlight .kt{color:#66d9ef;font-weight:bold}.highlight .kn{color:#f92672;font-weight:bold}.highlight .ow{color:#f92672;font-weight:bold}.highlight .o{color:#f92672;font-weight:bold}.highlight .mf{color:#ae81ff}.highlight .mh{color:#ae81ff}.highlight .il{color:#ae81ff}.highlight .mi{color:#ae81ff}.highlight .mo{color:#ae81ff}.highlight .m,.highlight .mb,.highlight .mx{color:#ae81ff}.highlight .se{color:#ae81ff}.highlight .sb{color:#e6db74}.highlight .sc{color:#e6db74}.highlight .sd{color:#e6db74}.highlight .s2{color:#e6db74}.highlight .sh{color:#e6db74}.highlight .si{color:#e6db74}.highlight .sx{color:#e6db74}.highlight .sr{color:#e6db74}.highlight .s1{color:#e6db74}.highlight .ss{color:#e6db74}.highlight .s{color:#e6db74}.highlight .na{color:#a6e22e}.highlight .nc{color:#a6e22e;font-weight:bold}.highlight .nd{color:#a6e22e;font-weight:bold}.highlight .ne{color:#a6e22e;font-weight:bold}.highlight .nf{color:#a6e22e;font-weight:bold}.highlight .no{color:#66d9ef}.highlight .bp{color:#f8f8f2}.highlight .nb{color:#f8f8f2}.highlight .ni{color:#f8f8f2}.highlight .nn{color:#f8f8f2}.highlight .vc{color:#f8f8f2}.highlight .vg{color:#f8f8f2}.highlight .vi{color:#f8f8f2}.highlight .nv{color:#f8f8f2}.highlight .w{color:#f8f8f2}.highlight .nl{color:#f8f8f2;font-weight:bold}.highlight .nt{color:#f92672}.highlight{color:#f8f8f2;background-color:#49483e}</style> <style>body{color:#333;font-family:"Helvetica Neue", "Helvetica", "Oxygen", "Ubuntu", sans-serif}header{height:40px;background-color:#333;text-align:center;width:100%;z-index:999;position:fixed;top:0;line-height:1.5}header a{color:#27ae60;display:inline-block;font-size:22px;padding-top:4px;text-decoration:none}header a:hover{text-decoration:none;color:#27ae60}.copyright{text-align:center;margin:25px;font-size:10px}.home{border-bottom:solid 1px #DDD;margin-top:70px;text-align:center;padding-bottom:50px}.home .headshot{border-radius:50%}.home .intro{font-size:18px}.home h1{border:none;font-size:42px}.home .contact{padding:10px;display:flex;flex-direction:row;justify-content:center;font-size:20px}@media (max-width: 500px){.home .contact{flex-wrap:wrap}.home .contact .contact-link{width:50%}}.home .contact-link{line-height:1;padding:7px;margin:10px;color:#2ecc71;border-radius:5px;border:1px solid #2ecc71}.home .contact-link:hover,.home .contact-link:focus{border-color:#27ae60;color:#1e8449;text-decoration:none}.posts{text-align:center;margin-bottom:30px}.posts h2{padding:30px}.posts ul{padding:0}.posts ul li{list-style-type:none;font-size:18px}.posts ul li a{color:#1e8449}.posts ul li a:hover{color:#2ecc71;text-decoration:none}.posts ul p{font-size:12px}.post{margin-top:50px;margin-bottom:30px;line-height:1.7}.post a{color:#27ae60}.post a:hover{color:#2ecc71;text-decoration:none}.post pre code{padding:10px;border-radius:10%;font-family:"Lucida Console", Monaco, monospace, "AdamicBee";color:white}.post blockquote{border-left:2px solid #DDD;color:#595959}.post iframe{margin-top:20px;width:100%;height:500px}.post article{font-size:18px}.post article .date{font-size:14px}
</style> </head> <body> <header> <a href="/">{ elliotec }</a> </header> <main class=post> <article> <h1>How to Get 100/100 Google Page Speed Score with Middleman and Nginx</h1> <p class=date>October 17, 2017 <h3>Everyone hates slow websites. Everyone likes fast websites.</h3> <p>I recently worked on a Google AMP (Accelerated Mobile Pages) project, which was created to mitigate bloated websites from being at the top of Google results on their mobile web index. I personally think AMP is a <a href="https://danielmiessler.com/blog/google-amp-not-good-thing/#gs.co7smnc">bad</a> <a href="https://www.theregister.co.uk/2017/05/19open_source_insider_google_amp_bad_bad_bad/">thing</a> <a href="https://daringfireball.net/linked/2017/01/17/schreiber-amp">for us</a> but that&rsquo;s beside the point of this article.</p> <p>The point of this article is that you can get a better user experience by just building websites that are fast, and you don&rsquo;t need to use AMP. But if you wanted to, the methods in this post could also be a good starting point for getting your pages into AMP with minimal effort.</p> <p>I use the static site generator Middleman for the front end of the website you&rsquo;re currently reading, and host it on a Digital Ocean Droplet in an Nginx server, so I&rsquo;ll give some examples of how I achieved the perfect score in the context of this blog and its stack.</p> <h3>Google PageSpeed Insights</h3> <p><a href="https://developers.google.com/speed/pagespeed/insights/">Google PageSpeed Insights</a> is a tool Google provides to score the speed of a website based on specific metrics including:</p> <ul> <li>Avoid landing page redirects</li> <li>Eliminate render-blocking JavaScript and CSS in above-the-fold content</li> <li>Enable compression</li> <li>Leverage browser caching</li> <li>Minify CSS</li> <li>Minify HTML</li> <li>Minify JavaScript</li> <li>Optimize images</li> <li>Prioritize visible content</li> <li>Reduce server response time</li> </ul> <p>I wanted a fast website, and I like to get 100% on things occasionally, so I set out on a quest to get elliotec.com the 100/100 score. So I got it. Now I&rsquo;m going to tell you how to get it.</p> <p><a href="https://developers.google.com/speed/pagespeed/insights/?url=https%3A%2F%2Felliotec.com"> <img src="../images/pagespeed-4d8b6b12.png"/> </a></p> <h3>Page size</h3> <p>Before getting into any of these rules in particular, lets talk about page size in general. Make your codebase small. If you don&rsquo;t need all of Bootstrap&rsquo;s enormous CSS codebase loading on all your pages, use something lighter and customize up. If you don&rsquo;t need a bunch of JavaScript on your page, like for a blog, then don&rsquo;t put it on there. Having a few little fancy animations at the expense of hundreds of milliseconds is usually not worth it to a user. That said, if a core part of the brand or requirements put you in a place where heavy JavaScript is necessary, there are still strategies you can use to keep it slim and fast.</p> <h3>Client and Server Control</h3> <p>One thing you&rsquo;ll need to get the 100/100 score is direct control of the front end assets and build tools around them. I used the static site generator Middleman to build this site with my configurations to increase the performance as much as possible. This website has virtually no JavaScript (other than the Squaresend plugin for email), but if I needed it I&rsquo;d be handling it like the rest of my assets.</p> <p>Additionally, you&rsquo;ll need full control of the server hosting your files. I use nginx on Digital Ocean when I want full control of my servers, and since it&rsquo;s just static files I don&rsquo;t actually have to setup a database or backend other than the nginx piece which is where a good chunk of the work here is.</p> <h3>Breaking down the metrics</h3> <p>Let&rsquo;s get into some details now.</p> <h4>Avoid landing page redirects</h4> <p>This first item is mostly self explanatory. You don&rsquo;t want to land on a page and redirect a user as much as possible. This is relatively common when a desktop site redirects to mobile, and it is very expensive in terms of performance. If possible, build a site that is designed mobile-first and responsive to prevent necessity of redirects to mobile versions of the site.</p> <h4>Enable Compression</h4> <p>Here we already need control of the server. Since http supports sending compressed files over the network for faster transfers, we should take advantage of Gzipping everything we can before it gets sent to the browser. It&rsquo;s super easy to enable with nginx and Middleman. In my global nginx conf, I have:</p> <div class=highlight><pre class="highlight nginx"><code><span class="c1">#nginx.conf
</span><span class="k">...</span>

<span class="s">http</span> <span class="p">{</span>
<span class="kn">...</span>
    <span class="s">sendfile</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">types_hash_max_size</span> <span class="mi">2048</span><span class="p">;</span>
    <span class="kn">server_names_hash_bucket_size</span> <span class="mi">128</span><span class="p">;</span>
    <span class="kn">include</span> <span class="n">/etc/nginx/mime.types</span><span class="p">;</span>
    <span class="kn">default_type</span> <span class="nc">application/octet-stream</span><span class="p">;</span>

    <span class="kn">gzip</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">gzip_disable</span> <span class="s">"msie6"</span><span class="p">;</span>
    <span class="kn">gzip_vary</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">gzip_proxied</span> <span class="s">any</span><span class="p">;</span>
    <span class="kn">gzip_comp_level</span> <span class="mi">6</span><span class="p">;</span>
    <span class="kn">gzip_buffers</span> <span class="mi">16</span> <span class="mi">8k</span><span class="p">;</span>
    <span class="kn">gzip_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
    <span class="kn">gzip_min_length</span> <span class="mi">256</span><span class="p">;</span>
    <span class="kn">gzip_types</span> <span class="nc">text/plain</span> <span class="nc">text/css</span> <span class="nc">application/json</span> <span class="nc">application/javascript</span> <span class="nc">text/xml</span> <span class="nc">application/xml</span> <span class="nc">application/xml</span><span class="s">+rss</span> <span class="nc">text/javascript</span> <span class="nc">application/x-font-ttf</span> <span class="nc">font/opentype</span> <span class="nc">image/svg</span><span class="s">+xml</span> <span class="nc">image/x-icon</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div> <p>And in my middleman config:</p> <div class=highlight><pre class="highlight ruby"><code>
<span class="c1"># config.rb</span>
<span class="n">configure</span> <span class="ss">:build</span> <span class="k">do</span>
  <span class="n">activate</span> <span class="ss">:gzip</span>
  <span class="o">...</span>
<span class="k">end</span>

</code></pre></div> <h4>Leverage browser caching</h4> <p>Caching allows the browser to keep downloaded assets for a set period of time so that it doesn&rsquo;t have to keep downloading the same files over and over. This is again quite easy to do with nginx by setting expirations for different filetypes, like how I have in my local nginx conf for this website:</p> <div class=highlight><pre class="highlight nginx"><code>
<span class="c1">#expiry map
</span><span class="k">map</span> <span class="nv">$sent_http_content_type</span> <span class="nv">$expires</span> <span class="p">{</span>
    <span class="kn">default</span>                     <span class="no">off</span><span class="p">;</span>
    <span class="kn">text/html</span>                   <span class="s">epoch</span><span class="p">;</span>
    <span class="kn">text/css</span>                    <span class="s">max</span><span class="p">;</span>
    <span class="kn">application/javascript</span>      <span class="s">max</span><span class="p">;</span>
    <span class="kn">application/x-font-ttf</span>      <span class="s">max</span><span class="p">;</span>
    <span class="kn">application/x-font-otf</span>      <span class="s">max</span><span class="p">;</span>
    <span class="kn">application/font-woff</span>       <span class="s">max</span><span class="p">;</span>
    <span class="kn">application/font-woff2</span>      <span class="s">max</span><span class="p">;</span>
    <span class="kn">~image/</span>                     <span class="s">max</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">listen</span> <span class="s">[::]:80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">elliotec.com</span> <span class="s">www.elliotec.com</span><span class="p">;</span>
    <span class="kn">expires</span> <span class="nv">$expires</span><span class="p">;</span>
    <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$server_name$request_uri</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div> <p>You can also ensure you are caching only files that haven&rsquo;t changed by setting unique asset hashes on the filenames, which is done in Middleman with a simple addition to the build config like so:</p> <div class=highlight><pre class="highlight ruby"><code>
<span class="c1"># config.rb</span>
<span class="o">...</span>
<span class="n">configure</span> <span class="ss">:build</span> <span class="k">do</span>
  <span class="n">activate</span> <span class="ss">:asset_hash</span>
  <span class="o">...</span>
<span class="k">end</span>

</code></pre></div> <h4>Minify assets</h4> <p>One of the more well known and simple page speed strategies is minifying your assets. Having a build step that minifies your HTML, CSS, and JavaScript is essential in modern web development, but it gets skipped a lot. You can drastically decrease your bundle sizes with minification. In Middleman, all you have to do is put a couple lines in your <code>config.rb</code> to do the work for you, like this:</p> <div class=highlight><pre class="highlight ruby"><code>
<span class="c1"># config.rb</span>
<span class="o">...</span>
<span class="n">configure</span> <span class="ss">:build</span> <span class="k">do</span>
  <span class="n">activate</span> <span class="ss">:minify_css</span>
  <span class="n">activate</span> <span class="ss">:minify_javascript</span>
  <span class="n">activate</span> <span class="ss">:minify_html</span>
  <span class="o">...</span>
<span class="k">end</span>

</code></pre></div> <p>The CSS and JS minification comes free with Middleman, but you&rsquo;ll have to add <code>gem middleman-minify-html</code> for the HTML piece which you definitely want even though it wont be giving you as large of gains as the other assets.</p> <h4>Optimize images</h4> <p>Images are usually the most expensive files for a browser to download as far as size and speed, so this is one of the areas that you can get some of the most performance gains for the effort. To start out, you&rsquo;ll usually want to have images at their lowest viable size and quality. Tools like Photoshop have the ability to do a lot of powerful work around this, but you can optimize them even more in a build step using a tool like imageoptim. Of course with Middleman this is pretty effortless. First you&rsquo;ll want to add <code>gem &#39;middleman-imageoptim&#39;, git: &#39;https://github.com/plasticine/middleman-imageoptim&#39;, branch: &#39;master&#39;</code> to your gemfile, then:</p> <div class=highlight><pre class="highlight ruby"><code>
<span class="c1"># config.rb</span>
<span class="o">...</span>
<span class="n">configure</span> <span class="ss">:build</span> <span class="k">do</span>
  <span class="n">activate</span> <span class="ss">:imageoptim</span>
<span class="k">end</span>

</code></pre></div> <p>Nice, you just shaved a ton of weight off those heavy images.</p> <h4>Reduce server response time</h4> <p>Google has a pretty strict threshold on the acceptable server response time - keep it under 200ms. For a static site like this, that is basically a non-issue. If I were hosting dozens of server blocks on this same Digital Ocean Droplet, they could be fighting for resources and slowing things down so I wouldn&rsquo;t recommend that. If you have a backend doing DB queries and such, there are numerous other reasons why your server could be slower than the 200ms threshold and you&rsquo;ll definitely want to spend time analyzing and improving that.</p> <h4>Prioritize visible content</h4> <p>Prioritizing visible content means that the above-the-fold content should be small enough in size to not require additional round trips to the server in order to render. This can be done by doing things like loading third party scripts later, and generally keeping the above-the-fold content small and fast. A lot of the other items in here will help with this, but sometimes it&rsquo;s really difficult to get this one perfect, especially if you have images as the initial visible content.</p> <h4>Eliminate render-blocking JavaScript and CSS in above-the-fold content</h4> <p>This is probably the trickiest item on the list, and it&rsquo;s related to the previous one. There are a few strategies I used to get this one to pass. One, if you require third party JavaScripts or add the <code>async</code> attribute to all <code>script</code> tags like this: <code>&lt;script async src=&quot;main.js&quot;&gt;</code>, so that external JavaScript files aren&rsquo;t blocking the loading and rendering of the other content and load asynchronously.</p> <p>Then, inline your CSS and JS instead of making external resource calls to them. Doing this by hand would be terrible and ugly, but we have tools to do this for us. There&rsquo;s a couple steps to get all your assets inlined on your pages.</p> <ul> <li>You&rsquo;ll first need to add sprockets (<code>gem &#39;middleman-sprockets&#39;</code>) to your app because we are hijacking Middleman&rsquo;s asset pipeline.</li> <li>Then in your <code>config.rb</code> add the <code>inline: true</code> hash to each minify build step like this:</li> </ul> <div class=highlight><pre class="highlight ruby"><code>
<span class="c1"># config.rb</span>
<span class="o">...</span>

<span class="n">configure</span> <span class="ss">:build</span> <span class="k">do</span>
  <span class="n">activate</span> <span class="ss">:minify_css</span><span class="p">,</span> <span class="ss">inline: </span><span class="kp">true</span>
  <span class="n">activate</span> <span class="ss">:minify_javascript</span><span class="p">,</span> <span class="ss">inline: </span><span class="kp">true</span>
  <span class="o">...</span>
<span class="k">end</span>

</code></pre></div> <ul> <li>Last, in your layout template where you pull in your CSS (wherever your <code>&lt;head&gt;</code> tag is probably):</li> </ul> <div class=highlight><pre class="highlight html"><code>
<span class="nt">&lt;style&gt;</span><span class="o">&lt;%=</span> <span class="nt">sprockets</span><span class="nc">.find_asset</span><span class="o">(</span><span class="s2">'site'</span><span class="o">)</span><span class="nc">.to_s</span> <span class="o">%&gt;</span><span class="nt">&lt;/style&gt;</span>

</code></pre></div> <p>and likewise for any scripts you want to inline, in <code>&lt;script&gt;</code> tags of course.</p> <p>Finally, I was having a lot of trouble getting the Google Analytics script on my site to not be render-blocking. It was the last thing on the list that I hadn&rsquo;t achieved, and I was pretty annoyed that I wasn&rsquo;t seeing that 100/100 score. Since my real goal was the number, and it was clear that my site was pretty fast already, <a href="https://stackoverflow.com/questions/29162881/pagespeed-insights-99-100-because-of-google-analytics-how-can-i-cache-ga">I found a silly hack online</a> to trick the Page Speed Insights tool to ignore the Google Analytics script. If they can contradict themselves I figure I can do this, and You Can Too!</p> <div class=highlight><pre class="highlight javascript"><code>
<span class="k">if</span><span class="p">(</span><span class="nb">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">"Speed Insights"</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">// Your Google Analytics Code Here</span>
<span class="p">}</span>

</code></pre></div> <h3>All done!</h3> <p>There ya go. If you followed the instructions in this post for your own self-hosted static site, you&rsquo;ll get 100/100 score on Google Page Speed. The speed is what matters and that&rsquo;s good for everyone using your website, and it&rsquo;s also gotta be good for some SEO, right?</p> </article> </main> <p class=copyright>&copy; Elliotec Software LLC</p> <a href="https://plus.google.com/+MichaelElliott-elliotec?rel=author"></a> <a href="https://plus.google.com/100799948688623726078?rel=publisher"></a> <script>
            if(navigator.userAgent.indexOf("Speed Insights") == -1) {
                  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
                  ga('create', 'UA-46276194-3', 'elliotec.com');ga('send', 'pageview');}
        </script> </body> </html>